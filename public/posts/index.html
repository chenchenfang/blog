<!DOCTYPE html>
<html lang="ch" dir="auto" data-theme="light">

<head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Posts | Fang7&#39;s blog</title>
<meta name="keywords" content="">
<meta name="description" content="Posts - Fang7&#39;s blog">
<meta name="author" content="fang7">
<link rel="canonical" href="http://localhost:1313/blog/posts/">
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/blog/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/blog/posts/index.xml" title="rss">
<link rel="alternate" hreflang="ch" href="http://localhost:1313/blog/posts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script><meta property="og:url" content="http://localhost:1313/blog/posts/">
  <meta property="og:site_name" content="Fang7&#39;s blog">
  <meta property="og:title" content="Posts">
  <meta property="og:description" content="干">
  <meta property="og:locale" content="ch">
  <meta property="og:type" content="website">
      <meta property="og:image" content="http://localhost:1313/blog/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/blog/images/papermod-cover.png">
<meta name="twitter:title" content="Posts">
<meta name="twitter:description" content="干">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/blog/posts/"
    }
  ]
}
</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/blog/" accesskey="h" title="Fang7&#39;s blog (Alt + H)">Fang7&#39;s blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/blog/archives" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/blog/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/blog/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/blog/">Home</a></div>
  <h1>
    Posts
    <a href="/blog/posts/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">多线程初始化类死锁
    </h2>
  </header>
  <div class="entry-content">
    <p>多线程初始化类死锁 前言 有一个MQ消费者程序,很久没有更新重启了,最近更新了代码,然后升级. 升级完之后看程序日志的打印,发现不往下走了,日志不动了,这个肯定不正常
解决思路 碰到这种问题,需要查看两个数据,一个是jvm内存数据也就是dump出来的数据,还有就是当前程序调用情况. 由于程序是刚重启,内存的问题可能性不大,所以我使用jstack把当前程序堆栈调用情况输出到文件中. 接下来就是检查这个文件中的内容,卡着不动,肯定是有代码了,然后发现很多都是java.lang.Thread.State: RUNNABLE,具体看如下
&#34;thread名称***&#34; #32 [27804] prio=5 os_prio=0 cpu=1379.98ms elapsed=362.77s tid=0x00007fdd6c8ec670 nid=27804 waiting on condition [0x00007fccf8d9b000] java.lang.Thread.State: RUNNABLE at staticdata.StaticDataLoad.loadCache(StaticDataLoad.java:129) - waiting on the Class initialization monitor for tools.Tool at staticdata.ExSystem.getCore_server_config(ExSystem.kt:1723) at staticdata.MediaDealIdInfo.init(MediaDealIdInfo.java:15) at staticdata.StaticDataLoad.&lt;init&gt;(StaticDataLoad.java:41) at staticdata.MediaDealIdInfo.&lt;init&gt;(MediaDealIdInfo.java:10) at staticdata.StaticData2.&lt;clinit&gt;(StaticData2.kt:452) ************************ at java.lang.Thread.runWith(java.base@21.0.1/Thread.java:1596) at java.lang.Thread.run(java.base@21.0.1/Thread.java:1583) &#34;ConsumeMessageThread_******_2&#34; #192 [27968] prio=5 os_prio=0 cpu=8.05ms elapsed=361.06s tid=0x00007fc9fc0025c0 nid=27968 waiting on condition [0x00007fcad01ec000] java.lang.Thread.State: RUNNABLE at bean.config.OkHttpConfig.&lt;init&gt;(OkHttpConfig.java:33) - waiting on the Class initialization monitor for staticdata.StaticData2 at tools.Tool.&lt;clinit&gt;(Tool.java:3779) org.apache.rocketmq.client.impl.consumer.ConsumeMessageConcurrentlyService$ConsumeRequest.run(ConsumeMessageConcurrentlyService.java:402) at java.util.concurrent.Executors$RunnableAdapter.call(java.base@21.0.1/Executors.java:572) at java.util.concurrent.FutureTask.run(java.base@21.0.1/FutureTask.java:317) at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@21.0.1/ThreadPoolExecutor.java:1144) at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@21.0.1/ThreadPoolExecutor.java:642) at java.lang.Thread.runWith(java.base@21.0.1/Thread.java:1596) at java.lang.Thread.run(java.base@21.0.1/Thread.java:1583) 两个线程分别在等待对方类初始化完成,导致程序卡主不动了,由此就找到了原因
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-01-21 21:20:00 +0800 CST'>January 21, 2025</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>fang7</span></footer>
  <a class="entry-link" aria-label="post link to 多线程初始化类死锁" href="http://localhost:1313/blog/posts/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B1%BB%E6%AD%BB%E9%94%81/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Okhttp发送请求卡住问题解决
    </h2>
  </header>
  <div class="entry-content">
    <p>Okhttp发送请求卡住问题解决 我们有一个消费者组是发送请求用的,一直有一个问题是有时候会堆积,然后就不消费了,重启后就恢复了.…
于是我让运维加了一个脚本,在堆积的时候触发这个脚本(dump出来文件),然后重启消费者组,先这样解决,等上班了再检查dump的文件
于是乎就有了下边这个图里的内容,发现其他线程都在wait,只有一个在runing,然后看到堆栈信息卡在了这个方法,点进去查看这个是一个native方法,这个目前看是做不了什么了
突然想到我们都是ipv4,这个是调用的ipv6的类,于是去查了资料发现可以在启动项上加-Djava.net.preferIPv4Stack=true{.language-plaintext .highlighter-rouge}来使用ipv4类,加上之后跑了一星期没有再出现之前的问题,问题解决
</p>
  </div>
  <footer class="entry-footer"><span title='2024-04-18 20:16:00 +0800 CST'>April 18, 2024</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>fang7</span></footer>
  <a class="entry-link" aria-label="post link to Okhttp发送请求卡住问题解决" href="http://localhost:1313/blog/posts/okhttp%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E5%8D%A1%E4%BD%8F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">IDEA 2024.1 版本提高流畅度方法
    </h2>
  </header>
  <div class="entry-content">
    <p>IDEA 2024.1 版本提高流畅度方法 今天看IDEA出了2024.1 ,本着尝鲜的想法安装了
正好前段时间测试了JDK21的分代ZGC,可以说基本就没有stop the world,这不都安装了新版本了,顺便修改一下运行的JDK版本和垃圾回收机制
按两下shift ,然后输入runtime,选择红框这个
然后会提示重启IDEA,重启完成后,开始修改垃圾回收为分代ZGC,打开修改框之后删除G1的开关,增加-XX:&#43;UseZGC -XX:&#43;ZGenerational 这两个参数,我顺便修改了-Xms2500m -Xmx2500m 最大最小堆内存,就不需要扩容了,也可以降低卡顿
关于ZGC调优,经过我之前的测试,ZGC基本是不需要刻意调整的,如果非要调整加大堆内存量,就可以了.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-03-21 20:25:00 +0800 CST'>March 21, 2024</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>fang7</span></footer>
  <a class="entry-link" aria-label="post link to IDEA 2024.1 版本提高流畅度方法" href="http://localhost:1313/blog/posts/idea-2024.1-%E7%89%88%E6%9C%AC%E6%8F%90%E9%AB%98%E6%B5%81%E7%95%85%E5%BA%A6%E6%96%B9%E6%B3%95/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">mysql连接数激增的问题解决过程
    </h2>
  </header>
  <div class="entry-content">
    <p> 平时mysql连接数大概在2000左右,会不定时随机的突然增加到5000,这个事情就很恐怖,所以需要查出来连接数增加的原因
分析与定位问题 {#%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98 tabindex=&#34;-1&#34;} 分析现有的监控和数据 {#%E5%88%86%E6%9E%90%E7%8E%B0%E6%9C%89%E7%9A%84%E7%9B%91%E6%8E%A7%E5%92%8C%E6%95%B0%E6%8D%AE tabindex=&#34;-1&#34;} 连接数 5000的报警钉钉信息 当连接数5000的时候,数据库里当前连接正在执行的状态 SELECT `id`,`user`,`host`,`db`,`command`,`time`,`state`,`info` FROM information_schema.processlist 分析第二个的数据,看到连接基本都在sleep,很少有正在执行的,由于连接数据库是通过内网代理连接的,所以不能直接看出来哪个或者哪些机器导致了这个问题
增加新的监控 {#%E5%A2%9E%E5%8A%A0%E6%96%B0%E7%9A%84%E7%9B%91%E6%8E%A7 tabindex=&#34;-1&#34;} 要定位哪里的问题就需要知道哪个程序或者哪个机器导致的,一步一步深入查,现在连哪个机器导致的问题都不知道,没办法去查,幸运的是这个问题是可以重现的,不必纠结过去没有数据,创造出新的数据再定位问题就行.
在这里就想到了netstat{.language-plaintext .highlighter-rouge}命令,这个可以在代理机器上执行,查看哪些IP连接了mysql代理服务,并统计个数,于是就把这个命令的触发加到了发送钉钉报警的程序里.
到这里又想到了一个问题,异常数据有了之后,没有正常的数据做对比还是定位不出来问题,所以增加了每分钟执行一次来保存正常数据用于做对比.
分析新监控数据 {#%E5%88%86%E6%9E%90%E6%96%B0%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE tabindex=&#34;-1&#34;} 等了1天终于等到了这个报警出现,对比平时的数据来说按连接数倒序,可以看到前边的大多数ip连接数都增加了,问了一下运维这些机器上都有哪些服务,被告知都是线上的tomcat服务.
到这里总算有了一些进展,但是到了这里又遇到问题了,tomcat里边虽然只有一个项目,但是这个项目中代码量很大,review代码是看不出来也没有办法都review一遍,有什么办法可以定位什么业务创建了连接呢?
之前读过一遍arthas的文档,对大概的命令以及功能有所了解,于是就想到了 stack{target=&#34;_blank&#34;} 这个命令,这个命令可以打印当前方法的调用堆栈信息,因为创建连接是必须new对象,那么监控这个new对象时候必须调用的方法就可以定位到具体的代码.
因为这个是随机性的bug,那么靠人手动执行是看不出问题的,于是使用了arthas提供的任务后台执行的方法,后台任务最多执行1天,同时需要指定抓取多少条堆栈信息.
之前没用过arthas,只是看文档知道执行stack会影响性能,但是具体影响多少性能并不清楚,这里找了一台线上tomcat手动执行stack,并观察了超时情况,超时只增加了0.5%,这个值可以接受,于是就开始后台执行了
等待新的监控数据 {#%E7%AD%89%E5%BE%85%E6%96%B0%E7%9A%84%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE tabindex=&#34;-1&#34;} 等啊等,终于等到了报警,查看对应时间的连接创建堆栈信息,问题出在缓存读取的方法上.
如果缓存没有就会读取数据库,同一时间突然有很多都去查询数据库了,原因是缓存里没有对应的数据了,缓存是一个concurrenthashmap,直接做的替换,而同时这个map会根据实际情况增加数据进入,由此可以判断是新加的那部分数据,缓存替换的时候消失了.
思考解决方案 {#%E6%80%9D%E8%80%83%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88 tabindex=&#34;-1&#34;} 缓存直接做替换是不行的,会丢失新加入的数据,那首先想到的是更新数据,更新数据会有一个问题是按之前逻辑新增加的那部分数据就会一直存在,内存也会越占用越多,所以需要有删除过期数据的程序,那么问题又来了,这个不好写,就算写了也不好维护.
这里就想到了Caffeine缓存框架,当真是很强大的本地内存缓存的框架,可以设置多久没有访问就会过期,也支持更新操作,对于我这个需求来说简直完美.
到了这里这个问题就算解决了,修改代码不过半小时的事情,主要的问题还是如何定位出来哪里代码有问题,
</p>
  </div>
  <footer class="entry-footer"><span title='2023-12-30 21:32:00 +0800 CST'>December 30, 2023</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>fang7</span></footer>
  <a class="entry-link" aria-label="post link to mysql连接数激增的问题解决过程" href="http://localhost:1313/blog/posts/mysql%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%BF%80%E5%A2%9E%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">OkHttp优化过程记录
    </h2>
  </header>
  <div class="entry-content">
    <p> 近期查看有请求下游系统超时,按百分比的话是0.8%的样子,但是每天量很大,超时总数不到1亿次,如果这个可以优化一点,提升巨大的
1.整体的探索过程 目前只知道最终结果是超时,但是是不是哪里代码写的有问题从而导致的超时,还需要去定位
1.1初步定为问题 首先记录两个时间,第一个是请求一进来一直到拼接发送请求的位置这段代码的,第二个是拼接请求一直到Response(或者超时了)这段代码的时间
超时情况:
不超时情况:
从图上来看,不管是超时和不超时都第一个时间都不长,所以是拼接请求到接受Response的时候引起的超时
1.2更细化的定位问题 现在知道是和发送请求有关系了,那么应该对于这部分代码增加详细的记录,来分析问题
OkHttp监控与调优查资料的时候看到这个文章写的不错
经过一番查找资料,okhttp有一个EventListener,可以记录发送请求的各个步骤的时间
于是就有了下边的代码
public class PrintingEventListener extends EventListener { @Override public void requestBodyEnd(@NotNull Call call, long byteCount) { printEvent(&#34;requestBodyEnd&#34;); } @Override public void requestBodyStart(@NotNull Call call) { printEvent(&#34;requestBodyStart&#34;); } @Override public void responseBodyEnd(@NotNull Call call, long byteCount) { printEvent(&#34;responseBodyEnd&#34;); } @Override public void responseBodyStart(@NotNull Call call) { printEvent(&#34;responseBodyStart&#34;); } @Override public void responseHeadersEnd(@NotNull Call call, @NotNull Response response) { printEvent(&#34;responseHeadersEnd&#34;); } @Override public void responseHeadersStart(@NotNull Call call) { printEvent(&#34;responseHeadersStart&#34;); } public static final Factory FACTORY = new Factory() { @Override public EventListener create(Call call) { //唯一标识 String randAllString = Format.getRandAllString(10); Random random = new Random(randAllString.hashCode()); double nextDouble = random.nextDouble(); //是tanx 与 10%的概率 if(call.request().url().toString().equals(&#34;xxx&#34;) &amp;&amp; nextDouble * 100 &lt;= 10){ InitServlet.okhttpTimeLog.plus(randAllString,&#34;startSend&#34;,0L,&#34;&#34;); //System.out.printf(&#34;%s %s%n&#34;, randAllString, call.request().url()); return new PrintingEventListener(randAllString, System.nanoTime()); }else{ return EventListener.NONE; } } }; final String callId; final long callStartNanos; public PrintingEventListener(String callId, long callStartNanos) { this.callId = callId; this.callStartNanos = callStartNanos; } private void printEvent(String name) { long elapsedNanos = System.nanoTime() - callStartNanos; InitServlet.okhttpTimeLog.plus(callId,name,elapsedNanos / 1000000L,&#34;&#34;); //System.out.printf(&#34;%s %.0fms %s%n&#34;, callId, elapsedNanos / 1000000d, name); } private void printEvent(String name,IOException ioe){ long elapsedNanos = System.nanoTime() - callStartNanos; InitServlet.okhttpTimeLog.plus(callId,name,elapsedNanos / 1000000L,ioe.getMessage()); //System.out.printf(&#34;%s %.0fms %s %s%n&#34;, callId, elapsedNanos / 1000000d, name,ioe.getMessage()); } @Override public void callStart(Call call) { printEvent(&#34;callStart&#34;); } @Override public void dnsStart(Call call, String domainName) { printEvent(&#34;dnsStart&#34;); } @Override public void dnsEnd(Call call, String domainName, List&lt;InetAddress&gt; inetAddressList) { printEvent(&#34;dnsEnd&#34;); } @Override public void connectStart(Call call, InetSocketAddress inetSocketAddress, Proxy proxy) { printEvent(&#34;connectStart&#34;); } @Override public void secureConnectStart(Call call) { printEvent(&#34;secureConnectStart&#34;); } @Override public void secureConnectEnd(Call call, @Nullable Handshake handshake) { printEvent(&#34;secureConnectEnd&#34;); } @Override public void connectEnd(Call call, InetSocketAddress inetSocketAddress, Proxy proxy, @Nullable Protocol protocol) { printEvent(&#34;connectEnd&#34;); } @Override public void connectFailed(Call call, InetSocketAddress inetSocketAddress, Proxy proxy, @Nullable Protocol protocol, IOException ioe) { printEvent(&#34;connectFailed&#34;); } @Override public void connectionAcquired(Call call, Connection connection) { printEvent(&#34;connectionAcquired&#34;); } @Override public void requestHeadersStart(Call call) { printEvent(&#34;requestHeadersStart&#34;); } @Override public void requestHeadersEnd(Call call, Request request) { printEvent(&#34;requestHeadersEnd&#34;); } @Override public void connectionReleased(Call call, Connection connection) { printEvent(&#34;connectionReleased&#34;); } @Override public void requestFailed(Call call, IOException ioe) { printEvent(&#34;requestFailed&#34;,ioe); } @Override public void responseFailed(Call call, IOException ioe) { printEvent(&#34;responseFailed&#34;,ioe); } @Override public void callFailed(Call call, IOException ioe) { printEvent(&#34;callFailed&#34;,ioe); } @Override public void callEnd(Call call) { printEvent(&#34;callEnd&#34;); } } 这个是记录的结果,这里只放一条数据了,可以明显看出来仅仅是等待Response的时候超时
...</p>
  </div>
  <footer class="entry-footer"><span title='2023-10-14 10:06:00 +0800 CST'>October 14, 2023</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>fang7</span></footer>
  <a class="entry-link" aria-label="post link to OkHttp优化过程记录" href="http://localhost:1313/blog/posts/okhttp%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="http://localhost:1313/blog/posts/page/2/">&nbsp;2/5&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>© <a href="https://github.com/adityatelange/hugo-PaperMod/graphs/contributors">PaperMod Contributors</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
